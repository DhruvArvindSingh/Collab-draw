(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[486],{2330:(t,e,i)=>{Promise.resolve().then(i.bind(i,7076))},7076:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>x});var s=i(6694),o=i(3286),n=i(9196),h=i(2569),r=i(6465),l=i(8900);async function a(t){var e;let i=[],s=await l.A.post("".concat(n.P,"/shapes/").concat(t),{},{withCredentials:!0});return 200!==s.status?(console.log("Fetched existing shapes failed with status",s.status),[]):(console.log("Fetched existing shapes with status 200 response:",s),null===(e=s.data.shapes)||void 0===e||e.map(t=>{let e=JSON.parse(t.shape);e&&(e.id=t.id),i.push(e)}),i)}class c{async fetchShapes(){console.log("Fetching shapes");let t=await a(this.room_id);this.Shape=t,this.drawShape()}setShape(t){console.log("Setting shape",t),this.S_shape=t,this.selectedShapes.length>0&&(console.log("Selected shapes length",this.selectedShapes.length),this.selectedShapes.forEach(t=>{this.Shape[t.index].color=t.prevColor,console.log("Shape after setting color",this.Shape[t.index])}),this.sendchanges(),this.selectedShapes=[],this.drawShape())}sendchanges(){this.selectedShapes.forEach(t=>{this.socket.send(JSON.stringify({type:"Change_attribute",shape:"".concat(JSON.stringify(this.Shape[t.index])),room_id:this.room_id,id:t.index}))})}setColor(t){console.log("Setting color",t),this.color=t,this.selectedShapes.length>0&&(this.selectedShapes.forEach((e,i)=>{this.Shape[e.index].color=t,this.selectedShapes[i].prevColor=t}),this.drawShape())}setLineWidth(t){console.log("Setting line width",t),this.lineWidth=t,this.ctx.lineWidth=this.lineWidth,this.selectedShapes.length>0&&(this.selectedShapes.forEach(e=>{this.Shape[e.index].lineWidth=t}),this.drawShape())}setRadius(t){console.log("Setting radius",t),this.radius=t,this.selectedShapes.length>0&&(this.selectedShapes.forEach(e=>{"rect"===this.Shape[e.index].type&&(this.Shape[e.index].radius=t)}),this.drawShape())}initialize(){this.socket.onmessage=t=>{let e=JSON.parse(t.data);if(console.log("New message with data ",e),"update_shape"===e.type){let t=JSON.parse(e.shape);t.id=e.id,this.Shape.push(t),this.drawShape()}if("delete_shape"===e.type&&(this.Shape=this.Shape.filter(t=>t.id!==e.id||(console.log("Deleting shape",t),!1)),this.drawShape()),"add_id"===e.type&&(this.Shape[e.shape_id].id=e.id,this.drawShape()),"Change_attribute"===e.type){console.log("Change_attribute data",e);let t=JSON.parse(e.shape);console.log("shape.id =",t.id),console.log("data.id =",e.id),this.Shape[e.id].id==t.id?(console.log("Shape id is same"),this.Shape[e.id]=t):(console.log("Shape id is not same"),this.Shape.find(i=>i.id==t.id&&(this.Shape[e.id]=t,!0))),this.drawShape()}}}initHandlers(){console.log("Initializing handlers"),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp)}drawShape(){var t,e;console.log("Drawing shape"),null===(t=this.ctx)||void 0===t||t.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="black",null===(e=this.ctx)||void 0===e||e.fillRect(0,0,this.canvas.width,this.canvas.height),this.Shape.map(t=>{var e,i,s,o,n,h,r,l,a,c;"rect"===t.type?(this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.lineWidth,null===(e=this.ctx)||void 0===e||e.beginPath(),null===(i=this.ctx)||void 0===i||i.roundRect(t.x,t.y,t.width,t.height,t.radius),null===(s=this.ctx)||void 0===s||s.stroke()):"circle"===t.type?(this.ctx.lineWidth=t.lineWidth,this.ctx.strokeStyle=t.color,null===(o=this.ctx)||void 0===o||o.beginPath(),null===(n=this.ctx)||void 0===n||n.arc(t.x,t.y,t.radius,0,2*Math.PI),null===(h=this.ctx)||void 0===h||h.stroke()):"line"===t.type&&(this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.lineWidth,null===(r=this.ctx)||void 0===r||r.beginPath(),null===(l=this.ctx)||void 0===l||l.moveTo(t.x,t.y),null===(a=this.ctx)||void 0===a||a.lineTo(t.x2,t.y2),null===(c=this.ctx)||void 0===c||c.stroke())}),this.ctx.lineWidth=this.lineWidth}destroy(){console.log("Destroying game"),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseup",this.handleMouseUp)}getShapesInside(t,e,i,s){let o=[];return this.Shape.forEach((n,h)=>{if("rect"===n.type){let r=n.x,l=n.y,a=n.x+n.width,c=n.y+n.height;Math.max(t,i)>Math.max(r,a)&&Math.min(t,i)<Math.min(r,a)&&Math.max(e,s)>Math.max(l,c)&&Math.min(e,s)<Math.min(l,c)&&o.push({index:h,prevColor:n.color})}else if("circle"===n.type){let r=n.x+n.radius,l=n.y+n.radius,a=n.x-n.radius,c=n.y-n.radius;Math.max(t,i)>Math.max(r,a)&&Math.min(t,i)<Math.min(r,a)&&Math.max(e,s)>Math.max(l,c)&&Math.min(e,s)<Math.min(l,c)&&o.push({index:h,prevColor:n.color})}else if("line"===n.type){let r=n.x,l=n.y,a=n.x2,c=n.y2;Math.max(t,i)>Math.max(r,a)&&Math.min(t,i)<Math.min(r,a)&&Math.max(e,s)>Math.max(l,c)&&Math.min(e,s)<Math.min(l,c)&&o.push({index:h,prevColor:n.color})}}),o}addListener(t){console.log("Adding listener for ",t);let e=document.getElementById("delete-btn");null==e||e.addEventListener("click",()=>{console.log("Deleting shapes",t),this.Shape=this.Shape.filter((e,i)=>{if(t.includes(i)){if(console.log("index",i),void 0==this.Shape[i].id||null==this.Shape[i].id)return console.error("shape id is undefined"),!1;let t=JSON.stringify(this.Shape[i]);this.socket.send(JSON.stringify({type:"delete_shape",room_id:this.room_id,shape:"".concat(t)}))}return!t.includes(i)}),this.drawShape()},{once:!0})}constructor(t,e,i,s,o,n,h){this.Shape=[],this.clicked=!1,this.startX=0,this.startY=0,this.width=0,this.height=0,this.prevX=0,this.prevY=0,this.radius=5,this.lineWidth=5,this.selectedShapes=[],this.handleMouseDown=t=>{this.clicked=!0,this.startX=t.clientX,this.startY=t.clientY,"doodle"===this.S_shape&&(this.prevX=t.clientX,this.prevY=t.clientY)},this.handleMouseMove=t=>{this.clicked&&(this.width=t.clientX-this.startX,this.height=t.clientY-this.startY,this.drawShape(),"rect"===this.S_shape?(this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.roundRect(this.startX,this.startY,this.width,this.height,this.radius),this.ctx.stroke()):"circle"===this.S_shape?(this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.arc(this.startX,this.startY,Math.sqrt(this.width*this.width+this.height*this.height),0,2*Math.PI),this.ctx.stroke()):"line"===this.S_shape?(this.ctx.strokeStyle=this.color,this.ctx.beginPath(),this.ctx.moveTo(this.startX,this.startY),this.ctx.lineTo(t.clientX-this.canvas.offsetLeft,t.clientY),this.ctx.stroke()):"doodle"===this.S_shape?(this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.prevX,this.prevY),this.ctx.lineTo(t.clientX,t.clientY),this.ctx.stroke(),this.Shape.push({x:this.prevX,y:this.prevY,x2:t.clientX,y2:t.clientY,type:"line",lineWidth:this.lineWidth}),this.socket.send(JSON.stringify({type:"update_shape",room_id:this.room_id,shape:'{ "x": '.concat(this.prevX,', "y": ').concat(this.prevY,', "x2": ').concat(t.clientX,', "y2": ').concat(t.clientY,', "type": "line", "color": "').concat(this.color,'", "lineWidth": ').concat(this.lineWidth," }")})),this.prevX=t.clientX,this.prevY=t.clientY):"select"===this.S_shape&&(this.ctx.fillStyle="rgba(57, 208, 231, 0.5)",this.ctx.fillRect(this.startX,this.startY,this.width,this.height)))},this.handleMouseUp=t=>{if(console.log("Mouse up"),this.clicked=!1,"rect"===this.S_shape)this.socket.send(JSON.stringify({id:this.Shape.length-1,type:"update_shape",room_id:this.room_id,shape:'{ "x": '.concat(this.startX,', "y": ').concat(this.startY,', "width": ').concat(this.width,', "height": ').concat(this.height,', "type": "rect", "color": "').concat(this.color,'", "lineWidth": ').concat(this.lineWidth,', "radius": ').concat(this.radius," }")}));else if("circle"===this.S_shape)this.socket.send(JSON.stringify({type:"update_shape",room_id:this.room_id,shape:'{ "x": '.concat(this.startX,', "y": ').concat(this.startY,', "radius": ').concat(Math.sqrt(this.width*this.width+this.height*this.height),', "type": "circle", "color": "').concat(this.color,'", "lineWidth": ').concat(this.lineWidth," }")}));else if("line"===this.S_shape)this.socket.send(JSON.stringify({type:"update_shape",room_id:this.room_id,shape:'{ "x": '.concat(this.startX,', "y": ').concat(this.startY,', "x2": ').concat(t.clientX,', "y2": ').concat(t.clientY,', "type": "line", "color": "').concat(this.color,'", "lineWidth": ').concat(this.lineWidth," }")}));else if("doodle"===this.S_shape)this.ctx.stroke(),this.ctx.beginPath();else if("select"===this.S_shape){if(this.selectedShapes=this.getShapesInside(this.startX,this.startY,t.clientX,t.clientY),console.log("Shapes inside",this.selectedShapes),0===this.selectedShapes.length){this.drawShape();return}this.selectedShapes.forEach(t=>{this.Shape[t.index].color="#FFD700"}),this.drawShape(),this.addListener(this.selectedShapes.map(t=>t.index))}},this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.S_shape=e,this.room_id=i,this.socket=s,this.color=o,this.lineWidth=n,this.radius=h,this.ctx&&(this.fetchShapes(),this.initialize(),this.initHandlers())}}function d(t){var e,i;let{S_shape:n,socket:h,room_id:l,color:a,lineWidth:d,radius:p}=t,[x,u]=(0,o.useState)(null),g=(0,o.useRef)(null),b=(0,r.lW)();return(0,o.useEffect)(()=>{null==x||x.setShape(n)},[x,n]),(0,o.useEffect)(()=>{null==x||x.setColor(a)},[x,a]),(0,o.useEffect)(()=>{null==x||x.setLineWidth(d)},[x,d]),(0,o.useEffect)(()=>{null==x||x.setRadius(p)},[x,p]),(0,o.useEffect)(()=>{if(g.current){let t=new c(g.current,n,l,h,a,d,p);return u(t),()=>{t.destroy()}}},[g,b]),(0,s.jsx)("canvas",{ref:g,width:null!==(e=b.width)&&void 0!==e?e:window.innerWidth,height:null!==(i=b.height)&&void 0!==i?i:window.innerHeight})}function p(t){let{room_id:e}=t,[i,r]=(0,o.useState)("null"),[l,a]=(0,o.useState)(null),[c,p]=(0,o.useState)("white"),[x,u]=(0,o.useState)(3),[g,b]=(0,o.useState)(5);return((0,o.useEffect)(()=>{let t=new WebSocket("".concat(n.Z,"?token=").concat(h.A.get("token")));t.onopen=()=>{a(t),console.log("Connected to server"),t.send(JSON.stringify({type:"join_room",room_id:e}))}},[]),null===l)?(0,s.jsx)("div",{children:(0,s.jsx)("h1",{children:"Connecting to server..."})}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("nav",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"#333",padding:"10px 20px",borderRadius:"30px",boxShadow:"0 2px 10px rgba(0,0,0,0.2)",zIndex:1e3},children:[(0,s.jsx)("button",{style:{padding:"8px 16px",margin:"0 5px",border:"none",borderRadius:"20px",backgroundColor:"select"===i?"#4CAF50":"#555",color:"white",cursor:"pointer",transition:"background-color 0.3s"},onClick:()=>"select"!==i?r("select"):r("null"),children:"Select"}),(0,s.jsx)("button",{style:{padding:"8px 16px",margin:"0 5px",border:"none",borderRadius:"20px",backgroundColor:"doodle"===i?"#4CAF50":"#555",color:"white",cursor:"pointer",transition:"background-color 0.3s"},onClick:()=>"doodle"!==i?r("doodle"):r("null"),children:"Doodle"}),(0,s.jsx)("button",{style:{padding:"8px 16px",margin:"0 5px",border:"none",borderRadius:"20px",backgroundColor:"rect"===i?"#4CAF50":"#555",color:"white",cursor:"pointer",transition:"background-color 0.3s"},onClick:()=>"rect"!==i?r("rect"):r("null"),children:"Rectangle"}),(0,s.jsx)("button",{style:{padding:"8px 16px",margin:"0 5px",border:"none",borderRadius:"20px",backgroundColor:"circle"===i?"#4CAF50":"#555",color:"white",cursor:"pointer",transition:"background-color 0.3s"},onClick:()=>"circle"!==i?r("circle"):r("null"),children:"Circle"}),(0,s.jsx)("button",{style:{padding:"8px 16px",margin:"0 5px",border:"none",borderRadius:"20px",backgroundColor:"line"===i?"#4CAF50":"#555",color:"white",cursor:"pointer",transition:"background-color 0.3s"},onClick:()=>"line"!==i?r("line"):r("null"),children:"Line"}),(0,s.jsx)("button",{style:{padding:"8px 16px",margin:"0 5px",border:"none",borderRadius:"20px",backgroundColor:"text"===i?"#4CAF50":"#555",color:"white",cursor:"pointer",transition:"background-color 0.3s"},onClick:()=>"text"!==i?r("text"):r("null"),children:"Text"})]}),(0,s.jsxs)("div",{style:{position:"fixed",top:"20px",left:"20px",backgroundColor:"#333",padding:"10px 10px",borderRadius:"30px",boxShadow:"0 2px 10px rgba(29, 29, 29, 0.2)",zIndex:1e3},children:[(0,s.jsx)("button",{style:{padding:"4px 8px",marginBottom:"7px",border:"#FFFFFF"===c?"4px solid black":"none",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#FFFFFF",color:"#FFFFFF",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#FFFFFF"),children:"●"}),(0,s.jsx)("button",{style:{padding:"4px 8px",marginBottom:"7px",border:"#4CAF50"===c?"4px solid black":"none",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#4CAF50",color:"#4CAF50",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#4CAF50"),children:"●"}),(0,s.jsx)("button",{style:{border:"#0000FF"===c?"4px solid black":"none",marginBottom:"7px",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#0000FF",color:"#0000FF",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#0000FF"),children:"●"}),(0,s.jsx)("button",{style:{border:"#800080"===c?"4px solid black":"none",marginBottom:"7px",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#800080",color:"#800080",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#800080"),children:"●"}),(0,s.jsx)("button",{style:{border:"#FF0000"===c?"4px solid black":"none",marginBottom:"7px",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#FF0000",color:"#FF0000",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#FF0000"),children:"●"}),(0,s.jsx)("button",{style:{border:"#8B00FF"===c?"4px solid black":"none",marginBottom:"7px",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#8B00FF",color:"#8B00FF",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#8B00FF"),children:"●"}),(0,s.jsx)("button",{style:{border:"#4B0082"===c?"4px solid black":"none",marginBottom:"7px",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#4B0082",color:"#4B0082",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#4B0082"),children:"●"}),(0,s.jsx)("button",{style:{border:"#FFFF00"===c?"4px solid black":"none",marginBottom:"7px",borderRadius:"50%",width:"25px",height:"25px",backgroundColor:"#FFFF00",color:"#FFFF00",cursor:"pointer",transition:"background-color 0.3s",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>p("#FFFF00"),children:"●"})]}),(0,s.jsxs)("div",{style:{fontFamily:"Arial, sans-serif",position:"fixed",bottom:"200px",left:"20px",backgroundColor:"#333",padding:"10px 10px",borderRadius:"10px",boxShadow:"0 2px 10px rgba(29, 29, 29, 0.2)",zIndex:1e3},children:[(0,s.jsxs)("div",{style:{color:"white",marginBottom:"2px",fontSize:"14px"},children:["Line Width: ",x]}),(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:(0,s.jsx)("input",{type:"range",min:"1",max:"10",step:"0.5",value:x,onChange:t=>u(parseFloat(t.target.value)),style:{width:"100px",accentColor:"#555"}})}),(0,s.jsxs)("div",{style:{color:"white",marginBottom:"2px",fontSize:"14px"},children:["Border Radius: ",g]}),(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:(0,s.jsx)("input",{type:"range",min:"0",max:"100",step:"1",value:g,onChange:t=>b(parseFloat(t.target.value)),style:{width:"100px",accentColor:"#555"}})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",gap:"10px"},children:[(0,s.jsx)("button",{style:{backgroundColor:"#555",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:"pointer",flex:1},id:"clear-btn",children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 25 25",fill:"currentColor",children:(0,s.jsx)("path",{d:"M5 13h14v-2H5v2zm-2 4h14v-2H3v2zM7 7v2h14V7H7z"})})}),(0,s.jsx)("button",{style:{backgroundColor:"#555",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:"pointer",flex:1},id:"undo-btn",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,s.jsx)("button",{style:{backgroundColor:"#d32f2f",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:"pointer",flex:1},id:"delete-btn",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})})]})]}),(0,s.jsx)(d,{socket:l,S_shape:i,room_id:e,color:c,lineWidth:x,radius:g})]})}function x(t){let{params:{room_id:e}}=t;return console.log("room_id",e),(0,s.jsx)(p,{room_id:e})}},9196:(t,e,i)=>{"use strict";i.d(e,{P:()=>s,Z:()=>o});let s="http://localhost:3001",o="ws://localhost:3002"}},t=>{var e=e=>t(t.s=e);t.O(0,[900,417,909,659,358],()=>e(2330)),_N_E=t.O()}]);